---
layout: post
title:  "TIL(20240607) [ë‰´ìŠ¤í”¼ë“œ í”„ë¡œì íŠ¸ : ì´ë©”ì¼ ê°€ì… ë° ì¸ì¦ ê¸°ëŠ¥]"
date:  2024-06-07
categories: TIL Spring ì½”ë”©í…ŒìŠ¤íŠ¸
---

---------------------------------------------------------------------


# ğŸ“Œ Spring

## ğŸ’¡ ë‰´ìŠ¤í”¼ë“œ í”„ë¡œì íŠ¸ : ì´ë©”ì¼ ê°€ì… ë° ì¸ì¦ ê¸°ëŠ¥
- ì´ë©”ì¼ ê°€ì… ì‹œ, **ì´ë©”ì¼ ì¸ì¦ ê¸°ëŠ¥**ì„ ì¶”ê°€
Step 1 : ì‚¬ìš©ìê°€ ê°€ì…í•œ ì´ë©”ì¼ ì£¼ì†Œë¡œ ì¸ì¦ë²ˆí˜¸ ë°œì†¡<br>
Step 2 : ë°œì†¡í•œ ì¸ì¦ë²ˆí˜¸ì™€ ì…ë ¥ë€ì˜ ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ” ì§€ í™•ì¸<br>
Step 3 : ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì€ íšŒì›ë“¤ì˜ `íšŒì›ìƒíƒœì½”ë“œ`ë¥¼ â€˜ì¸ì¦ ì „â€™ ìœ¼ë¡œ ì„¤ì •<br>

ì´ë©”ì¼ ê°€ì… ë° ì¸ì¦ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì´ì „ì— í”„ë¡œí•„ ë¶€ë¶„ì„ ìˆ˜ì •í•´ì•¼ í–‡ëŠ”ë°,
í”„ë¡œí•„ì—ì„œ ì´ë©”ì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ìˆì–´ì„œ ì´ë©”ì¼ì€ ìˆ˜ì •í•  ìˆ˜ ì—†ë„ë¡ í•˜ê³  ìœ ì € ì—”í‹°í‹°ì—ì„œ ì´ë©”ì¼ ë¶€ë¶„ì„ @Notnullë¡œ ë³€ê²½ì´ í•„ìš”í–ˆë‹¤.

ê·¸ë˜ì„œ ì»¬ëŸ¼ì—ëŠ” nullable=falseë¼ ë˜ì–´ ìˆëŠ”ë°, DBì—ì„œëŠ” DDLìƒì„± ì‹œ not nullë¡œ ìƒì„± ë˜ê² ì§€ë§Œ
entityì—ì„œë„ ê²€ì¦ì´ ì—°ê²°ë ê¹Œ? ë¼ëŠ” ì˜ë¬¸ì´ ìƒê²¼ë‹¤. ê·¸ë˜ì„œ ì°¾ì•„ë³¸ ê²ƒì´ ì»¬ëŸ¼ì— nullable=falseí•˜ì§€ ì•Šê³  Validation- @NotNullë¡œ í•´ì£¼ë©´ ìë™ìœ¼ë¡œ DDLìƒì„± ì‹œ NotNullì´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤.

[Jpa:nullable=falseì™€ @NotNull](https://kafcamus.tistory.com/15)

ë³¸ê²©ì ìœ¼ë¡œ ì´ë©”ì¼ ì¸ì¦ êµ¬í˜„ì„ í•´ë³´ë ¤ê³  ì°¾ì•„ë³´ë‹ˆ, gradleì— ì˜ì¡´ì„± ì¶”ê°€ê°€ í•„ìš”í•˜ë‹¤.

```java

implementation 'org.springframework.boot:spring-boot-starter-mail'

```

ê·¸ ë‹¤ìŒ, êµ¬ê¸€ Gmailì˜ SMTPì„¤ì •(IMAP)ì„ í•˜ê³  application.propertiesì˜ ì„¤ì •ì„ í•´ì£¼ë©´ ë!
IMAP ì„¤ì •ë°©ë²• ë° ì•± ë¹„ë°€ë²ˆí˜¸ ìƒì„±ì€ êµ¬ê¸€ì— ê²€ìƒ‰í•˜ë©´ í•´ë‹¹ ë‚´ìš©ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 

[ì´ë©”ì¼ ì „ì†¡-SMTP](https://velog.io/@jungmin_/%EC%9D%B4%EB%A9%94%EC%9D%BC-%EC%A0%84%EC%86%A1%ED%95%98%EA%B8%B0-SMTP)
[Google Gmail SMTP ì„¤ì •ë°©ë²• ë° ë©”ì¼ ì „ì†¡1](https://hyunmin1906.tistory.com/276)
[Google Gmail SMTP ì„¤ì •ë°©ë²• ë° ë©”ì¼ ì „ì†¡2](https://gwamssoju.tistory.com/108)


```java

spring.mail.properties.mail.smtp.timeout=3000 // 3ë¶„ ë§Œë£Œ
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username={êµ¬ê¸€ì´ë©”ì¼ì£¼ì†Œ}
spring.mail.password={ì•± ë¹„ë°€ë²ˆí˜¸}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.ssl.protocols=TLSv1.2
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com

```


```java
@RestController
@RequiredArgsConstructor
@RequestMapping("/api/user")
public class UserController {

    private final UserService userService;
    private final JwtUtil jwtUtil;

    // ì¸ì¦ë²ˆí˜¸ ë°œì†¡
    @PostMapping("/email")
    public ResponseEntity<String> sendMail(@RequestBody @Valid EmailRequestDto requestDto) throws Exception {
        userService.sendMail(requestDto);
        return ResponseEntity.ok("ì¸ì¦ë²ˆí˜¸ ë°œì†¡ì™„ë£Œ");
    }

    // ì¸ì¦ë²ˆí˜¸ ì¼ì¹˜ì—¬ë¶€ í™•ì¸
    @GetMapping("/email/verify")
    public ResponseEntity<String> checkCode(@RequestBody @Valid VerifyCodeRequestDto requestDto) {
        userService.checkCode(requestDto);
        return ResponseEntity.ok("ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

```

ì•„ ì‚¬ì‹¤ ê¸°íšì„¤ê³„ê°€ ëª…í™•í•˜ê²Œ ë˜ì§€ ì•Šì€ ìƒíƒœë¼ ì´ ë¶€ë¶„ì—ì„œ ì •ë§ ê³ ë¯¼ì„ ë§ì´ í–ˆë‹¤.
ë³´í†µì˜ íšŒì›ê°€ì…ì„ ë³´ë©´ ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ì´ ë˜ê³  ì¸ì¦ë²ˆí˜¸ ì¼ì¹˜ì—¬ë¶€ í™•ì¸ ë˜í•œ ì¸ì¦ë²ˆí˜¸ í™•ì¸ ë²„íŠ¼ì´ ìˆëŠ” ê²½ìš°ë¥¼
ë§ì´ ë´ì„œ APIë¥¼ 3ê°œë¡œ ì„¤ê³„í•´ì•¼ê² ë‹¤ê³  ìƒê°í–ˆë‹¤.[1) ì¸ì¦ë²ˆí˜¸ ë°œì†¡ 2) ì¸ì¦ë²ˆí˜¸ í™•ì¸ 3) íšŒì›ê°€ì…] 

```java
@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    private final JavaMailSender javaMailSender;
    private static final String senderEmail = "ReviewSpot@gmail.com";
    private static int code;
    private final Map<String, String> codes = new HashMap<>();

    // ì¸ì¦ë²ˆí˜¸ ìƒì„±
    public static String createCode() {
        int code = (int) (Math.random() * (90000)) + 100000;
        return String.valueOf(code);
    }

    // ì´ë©”ì¼ ìƒì„±
    public MimeMessage createMail(String email, String code) throws MessagingException {
        createCode();
        MimeMessage message = javaMailSender.createMimeMessage();
        MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

        try {
            helper.setFrom(senderEmail);
            helper.setTo(email);
            helper.setSubject("ReviewSpot [íšŒì›ê°€ì…ì„ ìœ„í•œ ì´ë©”ì¼ ì¸ì¦]");
            String body = "";
            body += "<h3>" + "ì´ë©”ì¼ ì¸ì¦ ë²ˆí˜¸" + "</h3>";
            body += "<h1>" + code + "</h1>";
            body += "<h3>" + "ìœ„ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." + "</h3>";
            helper.setText(body, true);
        } catch (MessagingException e) {
            e.printStackTrace();
        }
        return message;
    }

    // ì´ë©”ì¼ ì „ì†¡
    public void sendMail(EmailRequestDto requestDto) throws MessagingException {
        String code = createCode();
        // ì¸ì¦ë²ˆí˜¸ ì„ì‹œì €ì¥
        codes.put(requestDto.getEmail(), code);
        MimeMessage message = createMail(requestDto.getEmail(), code);

        javaMailSender.send(message);
    }

    // ì¸ì¦ë²ˆí˜¸ ê²€ì¦
    public boolean checkCode(VerifyCodeRequestDto requestDto) {
        String email = requestDto.getEmail();
        String inputCode = requestDto.getVerificationCode();
        String checkCode = codes.get(email);

        if ((!checkCode.isEmpty()) && checkCode.equals(inputCode)) {
            return true;
        } else {
            throw new IllegalArgumentException("ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ ì¸ì¦ë²ˆí˜¸ ì…ë‹ˆë‹¤.");
        }
    }

    // íšŒì›ê°€ì…
    public void signup(SignupRequestDto requestDto) {
        String userId = requestDto.getUserId();
        String password = passwordEncoder.encode(requestDto.getPassword());
        String userName = requestDto.getUserName();
        String email = requestDto.getEmail();
        String verificationCode = requestDto.getVerificationCode();
        UserStatus userStatus = UserStatus.NOT_AUTH;

        // íšŒì› ì¤‘ë³µ í™•ì¸
        Optional<User> checkUsername = userRepository.findByUserId(userId);
        if (checkUsername.isPresent()) {
            throw new IllegalArgumentException("ì¤‘ë³µëœ ì‚¬ìš©ìê°€ ì¡´ì¬í•©ë‹ˆë‹¤.");
        }

        // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
        Optional<User> checkEmail = userRepository.findByEmail(email);
        if (checkEmail.isPresent()) {
            throw new IllegalArgumentException("ì¤‘ë³µëœ Email ì…ë‹ˆë‹¤.");
        }

        // ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ ì‹œ íšŒì›ê°€ì…
        VerifyCodeRequestDto verifyCodeRequestDto = new VerifyCodeRequestDto(email, verificationCode);
        if (checkCode(verifyCodeRequestDto)) {
            userStatus = UserStatus.MEMBER;
            User user = new User(userId, password, userName, email, userStatus);
            userRepository.save(user);
        }
    }
```

ëœë¤ìœ¼ë¡œ ë‚œìˆ˜ ìƒì„±(ì¸ì¦ì½”ë“œ) í›„ì— ìš”ì²­í•œ ì´ë©”ì¼ê³¼ ì¸ì¦ì½”ë“œë¥¼ MAPì— ì„ì‹œì €ì¥ì„ í•˜ê³ 
ë©”ì¼ì„ ë³´ë‚¼ ë•Œ MimeMessageë¥¼ í†µí•´ì„œ í•´ë‹¹ ì´ë©”ì¼ì— ì½”ë“œë¥¼ ë„£ì–´ JavaMailSenderë¡œ ë³´ë‚´ëŠ” í˜•ì‹ìœ¼ë¡œ êµ¬í˜„í•´ë³´ì•˜ë‹¤. 

ì¸ì¦ë²ˆí˜¸ëŠ” Mapì— ì„ì‹œì €ì¥í–ˆë˜ email keyë¥¼ í†µí•´ codeë¥¼ ì°¾ì•„ inputcodeì™€ ì¼ì¹˜í•˜ë©´ ì¸ì¦ì²˜ë¦¬ í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤. Mapì„ í†µí•´ êµ¬í˜„í•œ ì´ìœ ë¥¼ ë¬»ëŠ”ë‹¤ë©´, ë³€ëª…ì„ ë³´íƒœ ì‚¬ì‹¤ ì‹œê°„ì´ ë¶€ì¡±í•´ì„œì˜€ë‹¤. íŒ€ì›ë“¤ê³¼ ê°™ì´ í”„ë¡œì íŠ¸ë¥¼ ë§ˆê°ê¸°í•œì„ ì •í•´ ì œì¶œí•˜ê¸° ì „ë‚  ì½”ë“œë¦¬ë·°ì™€ ì½”ë“œë¦¬íŒ©í† ë§ì„ í•˜ê¸°ë¡œ ì•½ì†í–ˆê¸°ì— ë¬´ì¡°ê±´ ì´ë²ˆì£¼ ì¼ìš”ì¼ê¹Œì§€ êµ¬í˜„ì„ í•´ì•¼ í–ˆë˜ í„°ë¼ DBì €ì¥ í˜•ì‹ìœ¼ë¡œ í•´ë³´ê³  ì‹¶ì—ˆì§€ë§Œ ë‹¤ìŒ ë²ˆì— ë„ì „í•´ë³´ê¸°ë¡œ í–ˆë‹¤. 

ê·¸ë¦¬ê³  ì–´ë ¤ì› ë˜ ë¶€ë¶„ì„ ì–˜ê¸°í•˜ìë©´ SMTP ê°™ì€ ê²½ìš°ëŠ” ë²„ì „ì´ ë‹¤ì–‘í•´ ë²„ì „ì´ í•˜ë‚˜ë¼ë„ ë§ì§€ ì•Šìœ¼ë©´ ì‹¤í–‰ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê¸€ì„ ë§ì´ ë³´ì•˜ë˜ ê²ƒ ê°™ë‹¤. ë‚˜ ì—­ì‹œë„ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ì— ì§ë©´í–ˆê³  3ì‹œê°„ ë™ì•ˆ ì›ì¸ì„ ì°¾ê¸° ìœ„í•´ ê³ êµ°ë¶„íˆ¬í–ˆë‹¤. 

```java

"Error": "Mail server connection failed. Failed messages: jakarta.mail.NoSuchProviderException: smtp"

```

application.propertiesì— ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€í–ˆë”ë‹ˆ.. ì„±ê³µ... ğŸ˜‚ ìš¸ë»”í–ˆë‹¤... í•˜í•˜í•³
ì‚¬ì‹¤ ê²°êµ­ì—ëŠ” íŠœí„°ë‹˜ì˜ ë„ì›€ì„ ë°›ì•˜ë‹¤. 5ì‹œê°„ ë™ì•ˆ ë²„ì „ì„ ì°¾ì•„ ì ìš©í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ë°˜ë³µí–ˆëŠ”ë° ë„ë¬´ì§€ ì–´ë–¤ ë¶€ë¶„ì—ì„œ ì˜ëª»ë˜ì—ˆëŠ”ì§€ íŒŒì•…í•˜ì§€ ëª»í–ˆê¸° ë•Œë¬¸ì´ë‹¤. ë‹¤ìŒë²ˆì—ëŠ” ì´ëŸ° ë¶ˆìƒì‚¬ê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ìˆ˜ë™ìœ¼ë¡œ SMTP ì„¤ì •í•˜ë„ë¡ í•´ì•¼ê² ë‹¤. 

```java

spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com

```


```java

public enum UserStatus {
    MEMBER("ì •ìƒ íšŒì›"),
    NON_MEMBER("íƒˆí‡´ íšŒì›"),
    NOT_AUTH("ì¸ì¦ ì „");

@Getter
public class VerifyCodeRequestDto {
    @Email(message = "ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    @NotBlank(message = "Emailì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String email;

    @NotNull(message = "Emailë¡œ ë°œì†¡ëœ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String verificationCode;

    public VerifyCodeRequestDto(String email, String verificationCode) {
        this.email = email;
        this.verificationCode = verificationCode;
    }
}

@Getter
public class EmailRequestDto {
    @Email(message = "ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    @NotBlank(message = "Emailì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String email;
}

```

ì´ë©”ì¼ ì¸ì¦ êµ¬í˜„ì€ ì •ë§ ë‹¤ì–‘í•œ ë°©ë²•ì´ ë§ì€ ê²ƒ ê°™ì•˜ë‹¤. jwtë¡œ í† í°ì„ ìƒì„±í•˜ì—¬ ì‚¬ìš©ìì •ë³´ë¥¼ í† í°ì— ë„£ì–´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í˜•ì‹ë„ ì°¾ì•„ë³´ë‹ˆ ìˆì—ˆë‹¤. ê·¸ë¦¬ê³  
ì¸ì¦ ë§Œë£Œì‹œê°„ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ìµœì í™” ëœ Redisë¡œ êµ¬í˜„ëœ ê²ƒë„ ë³´ì•˜ëŠ” ê²ƒ ê°™ë‹¤.
ì‚¬ì‹¤ ê¹Šì´ ê³µë¶€ë¥¼ í•˜ì§€ ëª»í•´ì„œ ì €ëŸ° ê²ƒë“¤ì´ ìˆêµ¬ë‚˜.. í•˜ê³  ë„˜ì–´ê°„ ê²ƒ ê°™ë‹¤. 

ëŒ“ê¸€ ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„ë„ ë‚¨ì•˜ê¸°ì— ë§ˆê°ê¸°í•œì— ì œì¶œí•  ìˆ˜ ì—†ì„ ê²ƒ ê°™ì•„ì„œ ë‹¤ìŒì— ë‚˜ì˜ ê°œì¸ í”„ë¡œì íŠ¸ì— í† í°ìœ¼ë¡œ ì´ë©”ì¼ ì¸ì¦êµ¬í˜„ì„ í•´ë³´ë ¤ê³  í•œë‹¤. ë¹ ìƒ¤ë¹ ìƒ¤ğŸ¦¾


---------------------------------------------------------------------

# ğŸ“Œ ì½”ë”©í…ŒìŠ¤íŠ¸1ï¸âƒ£ : í–‰ë ¬ì˜ ë§ì…ˆ

### ğŸ”’ ë¬¸ì œ : í–‰ë ¬ì˜ ë§ì…ˆì€ í–‰ê³¼ ì—´ì˜ í¬ê¸°ê°€ ê°™ì€ ë‘ í–‰ë ¬ì˜ ê°™ì€ í–‰, ê°™ì€ ì—´ì˜ ê°’ì„ ì„œë¡œ ë”í•œ ê²°ê³¼ê°€ ë©ë‹ˆë‹¤. 2ê°œì˜ í–‰ë ¬ arr1ê³¼ arr2ë¥¼ ì…ë ¥ë°›ì•„, í–‰ë ¬ ë§ì…ˆì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜, solutionì„ ì™„ì„±í•´ì£¼ì„¸ìš”.

### ğŸš« ì¡°ê±´ : 
- í–‰ë ¬ arr1, arr2ì˜ í–‰ê³¼ ì—´ì˜ ê¸¸ì´ëŠ” 500ì„ ë„˜ì§€ ì•ŠìŠµë‹ˆë‹¤.


## ğŸ”“ ë¬¸ì œí’€ì´

```java
class Solution {
    public int[][] solution(int[][] arr1, int[][] arr2) {
        int[][] answer = {};
        answer = new int[arr1.length][arr1[0].length]; // [ì„¸ë¡œ][ê°€ë¡œ] ê·¸ë¦¬ê³  arr1[][] == arr2[][]
        
        for (int i=0; i<arr1.length; i++){ // ì„¸ë¡œ
            for (int j=0; j<arr1[i].length; j++){ // ê°€ë¡œ
                answer[i][j] = arr1[i][j] + arr2[i][j];
            }
        }
        return answer;
    }
}
```




