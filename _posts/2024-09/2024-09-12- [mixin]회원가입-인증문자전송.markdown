---
layout: post
title:  "TIL(20240912) [project:Mixin] íšŒì›ê°€ì…-ì¸ì¦ë¬¸ìì „ì†¡"
date:  2024-09-12
categories: TIL
---

----------------------------------------------------------------------------

ì˜¤ë«ë§Œì— ì¸í…”ë¦¬ì œì´ë¥¼ ì—¬ë‹ˆ.. ê°íšŒê°€ ìƒˆë¡­ë‹¤..ğŸ¤£

ì¼ë‹¨ ì¸ì¦ë¬¸ì ì „ì†¡ êµ¬í˜„ì „ì— ëŒ€í•™êµ ê²€ìƒ‰ ì˜¤í”ˆ APIê°€ í•„ìš”í•´ì„œ í•™êµ ì •ë³´ API ì‹ ì²­í•´ë‘ì—ˆë‹¤.
[ì»¤ë¦¬ì–´ë„· OPEN API](https://www.career.go.kr/cnet/front/openapi/openApiSchoolCenter.do)
ì¼ë‹¨ ëŒ€í•™êµ ê²€ìƒ‰ APIë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œ ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆëŠ”ë°,
RestTemplateê³¼ Webclientì¸ë° RestTemplateëŠ” êµ¬ ë²„ì „(?) ì´ë¼ê³  í•˜ë©´ì€ WebclientëŠ” ìµœì‹  ë²„ì „ ê°™ì€ ëŠë‚Œì´ë‹¤.
ì–´ì¨‹ë“  ë™ê¸°ì‹ê³¼ ë¹„ë™ê¸°ì‹ ì²˜ë¦¬ì—ì„œ ì°¨ì´ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆëŠ”ë°.. ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” êµ¬í˜„í•  ë•Œ ì¡°ê¸ˆ ë” ê¹Šì´ ê³µë¶€ê°€ í•„ìš”í•  ë“¯ í•˜ë‹¤.

ì¼ë‹¨ ì˜¤í”ˆ API ì‹ ì²­ ëŒ€ê¸°ì¤‘ì´ë¼ ë§ˆëƒ¥ ê¸°ë‹¤ë¦´ ìˆ˜ ì—†ì–´ì„œ ì¸ì¦ë¬¸ì ì „ì†¡ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë ¤ê³  ë„˜ì–´ì™”ë‹¤.

ë³´í†µ SMSì „ì†¡ì€ SMS ê²Œì´íŠ¸ì›¨ì´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ë©°,  ëŒ€í‘œì ì¸ ì„œë¹„ìŠ¤ë¡œëŠ” Twilio, Nexmo, ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡, CoolSMSê°€ ìˆë‹¤.
ë‚˜ëŠ” ì²˜ìŒì— ë„¤ì´ë²„í´ë¼ìš°ë“œ í”Œë«í¼ì„ ì‚¬ìš©í•˜ë ¤ê³  ì‹œë„í–ˆëŠ”ë° ì‚¬ì—…ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ë¼ê³  í™•ì¸ì„ í•´ì„œ
Coolsmsë¡œ ì„ íƒí–ˆë‹¤. (ë¸”ë¡œê·¸ ìë£Œë„ í›¨ì”¬ ë§ì•˜ê³ , ê³µì‹ë¬¸ì„œë„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.)

íšŒì›ê°€ì…-> API ë°œê¸‰ -> APIkeyì™€ secretì„ ë©”ëª¨ì¥ì— ì ì–´ë‘ì.
ê·¸ë¦¬ê³  ì¶”ê°€ë¡œ ë²„ì „ì„ ì˜ í™•ì¸í•´ì„œ êµ¬í˜„ì„ í•´ì•¼í•œë‹¤. ë²„ì „ë§ˆë‹¤ êµ¬í˜„ ë°©ë²•ì´ ë‹¤ë¥¸ ë“¯ í•˜ë‹¤.

## ğŸ’¡ Coolsmsë¥¼ í†µí•´ SMS ì¸ì¦ë²ˆí˜¸ ë¬¸ìì „ì†¡ êµ¬í˜„

```java
	// nurigo SMSì¸ì¦
	implementation 'net.nurigo:sdk:4.3.0'
```

ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì£¼ê³ , 

```java
@Component
public class SmsCertificationUtil {
    
    @Value("${coolsms.apikey}")
    private String apiKey;

    @Value("${coolsms.apisecret}")
    private String apiSecret;

    @Value("${coolsms.fromnumber}")
    private String fromNumber;

    private DefaultMessageService messageService;

    @PostConstruct
    public void init(){
        this.messageService = NurigoApp.INSTANCE.initialize(apiKey, apiSecret, "https://api.coolsms.co.kr");
    }

    public void sendSMS(String to, String certificationCode){
        Message message = new Message();
        message.setFrom(fromNumber);
        message.setTo(to);
        message.setText("[Mixin]ì¸ì¦ë²ˆí˜¸ëŠ” " + certificationCode + " ì…ë‹ˆë‹¤.");

        this.messageService.sendOne(new SingleMessageSendingRequest(message));
    }
}
```

ê·¸ë¦¬ê³  sevice layer íŒ¨í„´ì„ ì´ìš©í•´ì„œ SmsServiceImpleì€ SmsServiceë¥¼ implements ë°›ì•„ì„œ í•´ë‹¹ í´ë˜ìŠ¤ì—ì„œ ì‹¤ì œ êµ¬í˜„ì„ ë‹´ë‹¹í•˜ê²Œ ëœë‹¤.

- ì„œë¹„ìŠ¤ ë ˆì´ì–´ (Service Layer): ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ë©°, ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. 
ì´ ë ˆì´ì–´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼, ì™¸ë¶€ API í˜¸ì¶œ, íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë“±ê³¼ ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•©ë‹ˆë‹¤.
- ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ (Service Interface): ì„œë¹„ìŠ¤ ë ˆì´ì–´ì˜ ë©”ì„œë“œë¥¼ ì •ì˜í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ, êµ¬í˜„ì²´ì™€ì˜ ì˜ì¡´ì„±ì„ ì¤„ì´ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
- ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ (Service Implementation): ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì •ì˜í•œ ë©”ì„œë“œë¥¼ ì‹¤ì œë¡œ êµ¬í˜„í•œ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.


```java
@Service
@RequiredArgsConstructor
public class SmsServiceImpl implements SmsService{

    private final SmsCertificationUtil smsCertificationUtil;

    @Override
    public void sendSms(SmsRequestDto smsRequestDto) {
        String phoneNumber = smsRequestDto.getPhoneNumber();
        String certificationCode = Integer.toString((int)(Math.random() * (999999 - 100000 + 1)) + 100000);
        smsCertificationUtil.sendSMS(phoneNumber, certificationCode);
    }
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ controller

```java
@RestController
@RequiredArgsConstructor
@RequestMapping("/api")
public class AuthController {

	private final AuthService authService;
	private final SmsService smsService;

	@PostMapping("/signup/sms")
	public ResponseEntity<CommonResponse<String>> sendSms(@Valid @RequestBody SmsRequestDto smsRequestDto) {
		smsService.sendSms(smsRequestDto);
		CommonResponse<String> response = new CommonResponse<>("ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.", 200, null);
		return new ResponseEntity<>(response, HttpStatus.OK);
	}
}
```

**controllerì˜ ì—­í• **

- ìš”ì²­ ìˆ˜ì‹  ë° ì²˜ë¦¬: í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ì ë˜ëŠ” ë‹¤ë¥¸ ì‹œìŠ¤í…œ)ë¡œë¶€í„°ì˜ HTTP ìš”ì²­ì„ ìˆ˜ì‹ í•˜ê³ , ìš”ì²­ URL, HTTP ë©”ì„œë“œ(GET, POST ë“±)ì— ë”°ë¼ ì ì ˆí•œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í˜¸ì¶œ: ìš”ì²­ì— ë”°ë¼ í•„ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ë ˆì´ì–´ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ë©°, ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ì—¬ ê²°ê³¼ë¥¼ ì–»ìŠµë‹ˆë‹¤.
- ë°ì´í„° ë³€í™˜: ìš”ì²­ì—ì„œ ì „ë‹¬ëœ ë°ì´í„°ë¥¼ í•„ìš”í•œ í˜•íƒœë¡œ ë³€í™˜í•˜ê±°ë‚˜, ì‘ë‹µ ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë§ëŠ” í˜•íƒœë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ DTO(Data Transfer Object)ë¡œ ë³€í™˜í•˜ê±°ë‚˜, ì„œë¹„ìŠ¤ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ JSON ë˜ëŠ” HTMLë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
- ì‘ë‹µ ìƒì„±: ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œ ì²˜ë¦¬ëœ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ HTTP ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ëŠ” ì›¹ í˜ì´ì§€, JSON ë°ì´í„°, XML ë°ì´í„° ë“± ë‹¤ì–‘í•œ í˜•íƒœê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì—ëŸ¬ ì²˜ë¦¬: ìš”ì²­ ì²˜ë¦¬ ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ì—¬ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ë‚˜ í˜ì´ì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.


**ì°¸ê³ **
[CoolSMSë¥¼ í†µí•´ í”„ë¡œì íŠ¸ì— íœ´ëŒ€í° ì¸ì¦ ê¸°ëŠ¥ êµ¬í˜„](https://velog.io/@l0o0lv/SpringBoot-CoolSMS%EB%A5%BC-%ED%86%B5%ED%95%B4-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%97%90-%ED%9C%B4%EB%8C%80%ED%8F%B0-%EC%9D%B8%EC%A6%9D-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84)
