---
layout: post
title:  "TIL(20240818) [ì¬ì‹œë„- ì¿¼ë¦¬ìµœì í™”ì™€ ì„±ëŠ¥ìµœì í™” QAí™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸]"
date:  2024-08-18
categories: TIL 
---

----------------------------------------------------------------------------

ë‚´ê°€ ì´ë•Œê¹Œì§€ ì¸ë±ìŠ¤ ê³µë¶€ë¥¼ ì˜ëª»í–ˆì—ˆë‚˜ë³´ë‹¤.

ì¸ë±ìŠ¤ê°€ ì ìš©ì´ ì•ˆë˜ì—ˆëŠ”ë°, ì¸ë±ìŠ¤ ì ìš©ì´ ë˜ì—ˆë‹¤ê³  ìƒê°í•˜ê³  EXPLAIN ëª…ë ¹ì–´ë¡œ ì¸ë±ìŠ¤ì ìš©ì´ ë˜ì—ˆëŠ”ì§€ ë³´ë©´ ALLë¡œ ëœ¨ë©´ì„œ ê³„ì†ì—ì„œ í…Œì´ë¸” í’€ìŠ¤ìº”ì„ í•˜ê³  ìˆë‹¤ëŠ” ì‘ë‹µì„ ë°›ê³  ìˆì—ˆì§€.

ê·¸ë˜ì„œ ë­”ê°€ ì´ìƒí•´ì„œ ê³„ì† ì°¾ì•„ë³´ê³  ì°¾ì•„ë³´ë‹ˆ ë‚´ê°€ ì¸ë±ìŠ¤ì ìš©ì„ ë˜‘ë°”ë¡œ í•˜ì§€ ì•Šì•˜ë‹¤. ê·¸ëŸ¬ë‹ˆê¹Œ ì¸ë±ìŠ¤ ì ìš©ì„ í•˜ì§€ ì•Šê³  ì¸ë±ìŠ¤ ì ìš©ì´ ë˜ì—ˆë‹¤ê³  ìƒê°í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¸ ê²©..ğŸ˜… ë©ì¶©..?

```
**EXPLAIN ëª…ë ¹ì–´ ì‚¬ìš©: EXPLAIN ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ê°€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
ex) EXPLAIN SELECT * FROM user ORDER BY point DESC LIMIT 10;
```

ê·¸ë˜ì„œ ë‹¤ì‹œ ì¸ë±ìŠ¤ë¡œ í¬ì¸íŠ¸ ë­í‚¹ì¡°íšŒë¥¼ ì¿¼ë¦¬ìµœì í™”ë¥¼ ë‹¤ì‹œ ì‹œë„í•´ë³´ë ¤ê³  í•œë‹¤.


## ğŸ’¡ í¬ì¸íŠ¸ ë­í‚¹ì¡°íšŒ ê¸°ëŠ¥ì— ì¸ë±ìŠ¤ ì¿¼ë¦¬ìµœì í™”ê°€ ì í•©í•œê°€? (ê²°ê³¼:NO)

1. ì¸ë±ìŠ¤ ì¶”ê°€

```
CREATE INDEX idx_point_desc ON db_users(point DESC);
```

SQL ì½˜ì†”ì—ì„œ user í…Œì´ë¸”ì˜ point í•„ë“œì— ë‚´ë¦¼ì°¨ìˆœ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤. ì´ë ‡ê²Œ ì„¤ì •ì„ í•´ë‘ë©´ ORDER BY point DESC ì¿¼ë¦¬ ì„±ëŠ¥ì´ í¬ê²Œ í–¥ìƒëœë‹¤.

ê·¸ ë‹¤ìŒ 

2. SHOW INDEX FROM db_users; ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ point í•„ë“œì— ëŒ€í•œ ì¸ë±ìŠ¤ê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
- SHOW INDEX ê²°ê³¼ë¥¼ ë³´ë©´ idx_point_desc ì¸ë±ìŠ¤ê°€ ì œëŒ€ë¡œ ìƒì„±ëœ ê²ƒì„ í™•ì¸

![image](https://github.com/user-attachments/assets/c02cbcd9-d095-47fa-97d0-31755d3091e7)


3. SELECT * FROM db_users ORDER BY point DESC LIMIT 10; ì¿¼ë¦¬ ì‹¤í–‰í•´ë³´ê¸° (í•´ë‹¹ ì¿¼ë¦¬ê°€ ì˜ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸)

![image](https://github.com/user-attachments/assets/93564291-6eff-40d2-8a4f-39fe9d006cef)

4. EXPLAIN SELECT * FROM db_users ORDER BY point DESC LIMIT 10; ì¿¼ë¦¬ê°€ ì¸ë±ìŠ¤ë¥¼ ì˜ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆëŠ”ì§€ í™•ì¸

![image](https://github.com/user-attachments/assets/c6a4bec6-ae96-496d-a3e1-663da8a73388)

- EXPLAIN ê²°ê³¼ì—ì„œ ALLê³¼ Using filesortê°€ ë‚˜íƒ€ë‚œë‹¤ë©´ ì¸ë±ìŠ¤ê°€ ìµœì í™”ì— ì í•©í•˜ì§€ ì•Šë‹¤ëŠ” ì˜ë¯¸
- typeì— ALLì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”ì„ ì„ íƒí–ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸

5. í˜¹ì‹œë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì˜ í†µê³„ê°€ ì˜¤ë˜ë˜ì–´ì„œ? ê·¸ëŸ°ê°€.. ì—…ë°ì´íŠ¸ë¥¼ í–ˆìœ¼ë‚˜
![image](https://github.com/user-attachments/assets/06c726c7-d14d-4516-bca6-a0a2b7c87db9)

ê²°ê³¼ì ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ì¿¼ë¦¬ìµœì í™”ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨í–ˆëŠ”ë° ê·¸ ì´ìœ ëŠ” 

1. ì¸ë±ìŠ¤ì˜ ì¦ì€ ì—…ë°ì´íŠ¸ : point ì»¬ëŸ¼ì€ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ íŠ¹ì„±ìƒ ìì£¼ ì—…ë°ì´íŠ¸ ë˜ê¸°ì— ì¸ë±ìŠ¤ì˜ ìœ ì§€ ë¹„ìš©ì´ ì¦ê°€í•˜ê¸°ì— ì„±ëŠ¥ì— ë¶€ì •ì ì¸ ì˜í–¥ì„ ì¤„ ê²ƒìœ¼ë¡œ ì˜ˆìƒ(ë°ì´í„°ê°€ ë³€ê²½ë ë•Œë§ˆë‹¤ ì¸ë±ìŠ¤ë„ ì—…ë°ì´íŠ¸ ë˜ì–´ì•¼ í•¨)
- ì¸ë±ìŠ¤ëŠ” ì£¼ë¡œ ì½ê¸° ì‘ì—…ì—ì„œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ëŠ”ë° ì¦ì€ ì“°ê¸°,ì—…ë°ì´íŠ¸ì˜ ê²½ìš° ì˜¤íˆë ¤ ì„±ëŠ¥ì €í•˜ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŒ(ì¸ë±ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œì˜ ì¶”ê°€ì ì¸ ì˜¤ë²„í—¤ë“œ)

2. ë°ì´í„° ë¶„í¬ ë¶ˆê· í˜•: íŠ¹ì • point ê°’ì— ë§ì€ ë°ì´í„°ê°€ ì§‘ì¤‘ë˜ì–´ ìˆì„ ë•Œ, ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ë ¬í•˜ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŒ

3. explain ê²°ê³¼ë¡œ `ALL`ê³¼ `Using filesort`ê°€ ë‚˜íƒ€ë‚œ ê²½ìš° 
 MySQLì˜ ì¿¼ë¦¬ ì˜µí‹°ë§ˆì´ì €ê°€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œì™€ ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”ì„ ì„ íƒí•  ë•Œê°€ ìˆëŠ”ë°, ì—¬ê¸°ì„œ ì˜µí‹°ë§ˆì´ì €ê°€ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”ë³´ë‹¤ ë” ë¹„íš¨ìœ¨ì ì´ë¼ê³  íŒë‹¨í–ˆê¸°ì— ì €ëŸ° ê²°ê³¼ë¥¼ ì£¼ì§€ ì•Šì•˜ì„ê¹Œ ì¶”ì¸¡í•¨

```
** ì¿¼ë¦¬ ì˜µí‹°ë§ˆì´ì €ëŠ” ì¿¼ë¦¬ ì„±ëŠ¥ì„ ìµœì í™”í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì‹¤í–‰ ê³„íšì„ ë¶„ì„í•˜ê³  ì„ íƒí•˜ëŠ” ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´ 

SELECT * FROM users WHERE age > 30 ORDER BY name;

í–ˆì„ë•Œ ì¿¼ë¦¬ ì˜µí‹°ë§ˆì´ì €ëŠ” 

- ì¸ë±ìŠ¤ ì‚¬ìš©: age ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ê°€ ìˆë‹¤ë©´ ì´ë¥¼ ì‚¬ìš©í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •
- ì •ë ¬ ë°©ë²•: name ì»¬ëŸ¼ìœ¼ë¡œ ì •ë ¬í•  ë•Œ ì‚¬ìš©í•  ì •ë ¬ ë°©ë²•ì„ ê²°ì •
- í…Œì´ë¸” ì¡°ì¸: ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ëŠ” ê²½ìš°, ì¡°ì¸ì˜ ìˆœì„œì™€ ë°©ë²•ì„ ê²°ì •
```

ê·¸ë˜ì„œ ì¸ë±ìŠ¤ë¡œ ì¿¼ë¦¬ìµœì í™” ë°©ë²•ì€ ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ê¸°ë¡œ í–ˆë‹¤.

```
// behind
ì¸ë±ìŠ¤ ì¶”ê°€í–ˆë˜ ê²ƒ ì‚­ì œí•´ì£¼ê¸° 

DROP INDEX idx_point_desc ON db_users; // ì‚­ì œ
SHOW INDEX FROM db_users; // ì‚­ì œ ë˜ì—ˆëŠ”ì§€ í™•ì¸
```

## ğŸ’¡ QA í™˜ê²½ì—ì„œ í¬ì¸íŠ¸ ë­í‚¹ì¡°íšŒ í…ŒìŠ¤íŠ¸ ê²°ê³¼

ì¿¼ë¦¬ë¬¸ í™•ì¸

spring data jpa
![image](https://github.com/user-attachments/assets/ccb1fe30-a66b-4261-9852-661a6af77795)

Querydsl
![image](https://github.com/user-attachments/assets/607929cc-5c8f-4eeb-b1c0-0820c54bd774)


--------QAí™˜ê²½-------------------------
ê³µí†µê¸°ì¤€ : ìœ ì € 1000ëª… ë”ë¯¸ë°ì´í„° ìƒì„±

spring data jpa
![image](https://github.com/user-attachments/assets/aacd7f59-6ad2-4f68-b10c-93a578688ad7)

QueryDSL
![image](https://github.com/user-attachments/assets/53712429-809b-43ef-9a9d-e53ec096aa89)

redis
![image](https://github.com/user-attachments/assets/84776ed0-ea35-41a2-8646-123a0e2aab05)


ì²˜ìŒ ë¡œì»¬ì—ì„œ ì„±ëŠ¥í…ŒìŠ¤íŠ¸ë¥¼ í–ˆì„ ë•Œ 1600ms ë•Œë¬¸ì— ì¶©ê²©ë°›ì•„ì„œ ì‹œì‘í–ˆë˜ ì„±ëŠ¥í…ŒìŠ¤íŠ¸ê°€ ì‹¤ì œ QAí™˜ê²½ì´ t2.small ì¸ë°
ì €ë ‡ê²Œ ë¯¸ë¬˜í•˜ê²Œ ì°¨ì´ê°€ ë‚˜ë‹¤ë‹ˆ.. í•˜í•˜í•˜í•˜...
ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë„ í™•ì‹¤ì¹˜ ì•Šë‹¤ëŠ” ê±¸ ê¹¨ë‹¬ì•˜ë‹¤.ğŸ˜‚

