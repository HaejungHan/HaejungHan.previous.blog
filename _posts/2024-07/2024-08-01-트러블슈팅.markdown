---
layout: post
title:  "TIL(20240801) [í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œ ë Œë”ë§ ê³¼ì •ì—ì„œ ë°œìƒí•œ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…]"
date:  2024-08-01
categories: TIL Vue.js
---

----------------------------------------------------------------------------

## ğŸ”’ ë¬¸ì œë°œìƒ : í”„ë¡ íŠ¸ ì—°ê²°ì‹œ í† í°ì˜¤ë¥˜ 

í˜„ì¬ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìª½ì— í† í°ì´ ì €ì¥ë˜ê³  ìˆë‹¤.

ë°±ì—”ë“œìª½ì—ì„œ ì•„ë˜ ì—ëŸ¬ ë°œìƒ

```
Token Error: Illegal base64url character: ' '
```

í•´ë‹¹ì˜¤ë¥˜ëŠ” Base64 URL ì¸ì½”ë”© í† í°ì„ ë””ì½”ë”©í•˜ëŠ” ë° ë¬¸ì œê°€ ìˆìœ¼ë©° ì˜ëª»ëœ ë¬¸ì, íŠ¹íˆ ê³µë°± ' 'ì´ ë°œê²¬ë˜ì—ˆìŒì„ ë‚˜íƒ€ë‚´ëŠ” ì˜¤ë¥˜ë¼ê³  í•œë‹¤.

ê·¸ë˜ì„œ í† í°ì´ ì˜ëª» ì¸ì½”ë”©ë˜ì—ˆê±°ë‚˜ ì†ìƒë˜ì–´ ê³µë°±ì´ë‚˜ ê¸°íƒ€ ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì—ˆê¸°ì— ë°œìƒí•˜ëŠ” ë¬¸ì œë¼ê³  ìƒê°í•´ì„œ í”„ë¡ íŠ¸ ìª½ì—ì„œ í† í°ì˜ ê³µë°±ì„ ì œì™¸í•˜ê³  ì˜ë¼ì„œ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜í–‰

```
getToken() {
      const tokenWithPrefix = localStorage.getItem('accessToken')?.trim();
      return tokenWithPrefix ? tokenWithPrefix.replace('Bearer ', '').trim() : '';
    },
```

vue.js store/index.js

```
async fetchToken({commit}) {
      try {
        const token = localStorage.getItem('accessToken');
        commit('setAccessToken', token);
      } catch (error) {
        console.error('Failed to fetch token:', error);
        throw error;
      }
    }
```

## ğŸ”’ ë¬¸ì œë°œìƒ : í”„ë¡ íŠ¸ìª½ì—ì„œ íŒŒì¼ ì—…ë¡œë“œì‹œ íƒ€ì…ì´ ë§ì§€ ì•Šì•„ ë°œìƒí•˜ëŠ” ìƒí™© 

ë°±ì—”ë“œì—ì„œ ì•„ë˜ ì—ëŸ¬ ë°œìƒ

```
 Content-Type 'application/octet-stream' is not supported
```
- application/octet-stream: ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì¼ë°˜ MIME ìœ¼ë¡œ íŒŒì¼ì´ë‚˜ ë°ì´í„°ì˜ ìœ í˜•ì„ ì•Œ ìˆ˜ ì—†ê±°ë‚˜ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°ì— ìì£¼ ì‚¬ìš©ë¨

ë‘ ê°€ì§€ ì›ì¸ìœ¼ë¡œ ì˜ˆì¸¡

1. ìš”ì²­ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠëŠ” ì½˜í…ì¸  ìœ í˜•: íŠ¹ì • ì½˜í…ì¸  ìœ í˜•(ì˜ˆ: application/json ë˜ëŠ” application/x-www-form-urlencoded)ì„ ê¸°ëŒ€í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ì— ìš”ì²­ì„ ë³´ë‚´ì§€ë§Œ Content-Type í—¤ë”ë¥¼  application/octet-stream, ì„œë²„ê°€ ìš”ì²­ì„ ì ì ˆí•˜ê²Œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì§€ ëª»í•  ìˆ˜ ìˆë‹¤.

2. í´ë¼ì´ì–¸íŠ¸ì¸¡ ë¬¸ì œ: í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì— ëŒ€í•´ 'Content-Type'ì„ ì˜ëª» ì§€ì •í–ˆì„ ê²½ìš°, íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì „ì†¡ ì¤‘ì´ì§€ë§Œ ì—”ë“œí¬ì¸íŠ¸ê°€ ë‹¤ë¥¸ í˜•ì‹ì„ ìš”êµ¬í•˜ëŠ” ê²½ìš° ì´ëŸ° ì¼ì´ ë°œìƒí•  ìˆ˜ ìˆìŒ

```java
 @PostMapping(value = "/challenges/{challengeId}/verifications")
  public ResponseEntity<CommonResponseDto<VerificationResponseDto>> requestVerification(
	  @PathVariable("challengeId") Long challengeId,
	  @RequestPart(value="image") MultipartFile image,
	  @RequestPart("request") VerificationRequestDto requestDto,
	  @AuthenticationPrincipal UserDetailsImpl userDetails
  ) {
	VerificationResponseDto verification = verificationService.requestVerification(challengeId, image, requestDto, userDetails.getUser());
	return ResponseEntity.ok().body(new CommonResponseDto<>
		(HttpStatus.OK.value(), "ì±Œë¦°ì§€ ì¸ì¦ ìš”ì²­ ì„±ê³µ", verification));
  }
```

vue.js ì´ì „ ì½”ë“œ

```
 let formData = new FormData();
      formData.append('image', this.verificationImage);
      formData.append('request', JSON.stringify({
        title: this.verificationTitle,
        content: this.verificationContent
      }));
      fetch(`http://localhost:8080/api/challenges/${this.challengeId}/verifications`, {
        method: 'POST',
        body: formData,
        headers: {
          'Authorization': `Bearer ${token}`
```
ìˆ˜ì •í•œ ì½”ë“œ

```
try {
        let formData = new FormData();
        formData.append('image', this.verificationImage);
        const requestDto = {
          title: this.verificationTitle,
          content: this.verificationContent
        };
        formData.append('request', new Blob([JSON.stringify(requestDto)], { type: 'application/json' }));
        const response = await fetch(`http://localhost:8080/api/challenges/${this.challengeId}/verifications`, {
          method: 'POST',
          body: formData,
          headers: {
            'Authorization': `Bearer ${this.token}`
          }
        });
```

í•´ë‹¹ ì˜¤ë¥˜ëŠ” 2ë²ˆì— í•´ë‹¹í•˜ëŠ” ê²½ìš° ê°™ì•˜ë‹¤. Content-Typeì„ ì ì ˆí•˜ê²Œ ì„¤ì •í•˜ê±°ë‚˜ ìš”ì²­ ë³¸ë¬¸ì„ ì˜¬ë°”ë¥´ê²Œ í¬ë§·í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ë¬¸ì œ.

requestPart(FormDate)ë¡œ ê°™ì´ ë³´ë‚´ê¸° ë•Œë¬¸ì— ì„œë²„ìª½ì—ì„œ êµ¬ë³„ì„ ëª»í•˜ê³  ìˆë‹¤ê³  ìƒê°í–ˆë‹¤. 

FormDataë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ê³¼ JSON ë°ì´í„°ë¥¼ ë™ì‹œì— ì „ì†¡í•  ë•Œ Blobì„ í™œìš©í•˜ë©´ ì„œë²„ê°€ JSON í˜•ì‹ì„ ì¸ì‹í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ì•Œê²Œë˜ì–´ 

```
formData.append('request', new Blob([JSON.stringify(requestDto)], { type: 'application/json' }));
```

type: 'application/json' ëª…ì‹œí•´ì£¼ê³  Blobë¡œ í•œë²ˆ ë” ê°ì‹¸ì£¼ì—ˆë‹¤.

**'FormData'ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ë‚¼ ë•Œ ë°ì´í„°ì˜ ì½˜í…ì¸  ìœ í˜•ì€ 'FormData' API ìì²´ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤. JSON ë°ì´í„°ë¥¼ ë¬¸ìì—´ë¡œ ì§ì ‘ í¬í•¨í•˜ëŠ” ê²½ìš° í•´ë‹¹ ë¶€ë¶„ì˜ Content-Typeì€ ê¸°ë³¸ì ìœ¼ë¡œ application/octet-streamìœ¼ë¡œ ì„¤ì •ë  ìˆ˜ ìˆìœ¼ë©°, ì„œë²„ê°€ ì´ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ë„ë¡ êµ¬ì„±ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ”’ ë¬¸ì œë°œìƒ : í”„ë¡ íŠ¸ ì–´ë–¤ ì—ëŸ¬ì¸ì§€ ì•Œ ìˆ˜ ì—†ëŠ” ìƒí™© ë°œìƒ


 ì—ëŸ¬ì½”ë“œì— ë”°ë¼ í”„ë¡ íŠ¸ì—ì„œ alertì°½ì´ ë‹¤ë¥´ê²Œ ë³´ì´ëŠ” ë¶€ë¶„ì´ í•„ìš”í–ˆë‹¤. ì½˜ì†”ì°½ì—ëŠ” í•´ë‹¹ ì—ëŸ¬ë¥¼ ì•Œ ìˆ˜ ìˆì§€ë§Œ ìœ ì € ìª½ì—ì„œëŠ” ì–´ë–¤ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ í”„ë¡ íŠ¸ìª½ì—ì„œ ì²˜ë¦¬ë¥¼ í•´ì£¼ì§€ ì•Šìœ¼ë‹ˆ ì•Œ ìˆ˜ ì—†ê¸°ì— 

```
catch (error) {
        if (error.response) {
          const status = error.response.status;
          if (status === 409) {
            alert('ì´ë¯¸ ì‹ ì²­í•˜ì‹  ì±Œë¦°ì§€ì…ë‹ˆë‹¤.');
          } else if (status === 400) {
            alert('ë§ˆê°ëœ ì±Œë¦°ì§€ë¡œ ì°¸ì—¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          } else {
            alert('ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
          }
        } else {
          alert('ì„œë²„ì™€ì˜ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      }
```

ë°±ì—”ë“œì—ì„œ ì˜ˆì™¸ì²˜ë¦¬í•œ ì—ëŸ¬ì½”ë“œì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì •ì˜í•˜ì˜€ë‹¤.


## ğŸ”’ ë¬¸ì œë°œìƒ : í”„ë¡ íŠ¸ì—ì„œ í˜ì´ì§€ ì²˜ë¦¬ ì•ˆë˜ëŠ” ìƒí™© ë°œìƒ

ì»¨íŠ¸ë¡¤ëŸ¬ ìª½

```java
 @GetMapping
  public ResponseEntity<CommonResponseDto<List<ChallengeSummaryResponseDto>>> getAllChallenge(
	  @RequestParam(value = "page", defaultValue = "1") int page
  ) {
	List<ChallengeSummaryResponseDto> challengeList = challengeService.getAllChallenges(
		page - 1);
	return ResponseEntity.ok().body(new CommonResponseDto<>
		(HttpStatus.OK.value(), "ì±Œë¦°ì§€ ì „ì²´ ì¡°íšŒ ì„±ê³µ", challengeList));
  }
```

ë ˆí¬ì§€í† ë¦¬ ì„í”Œìª½

```java
 public List<ChallengeSummaryResponseDto> getChallengeList(int page) {
	QChallenge challenge = QChallenge.challenge;
	Pageable pageable = PageRequest.of(page, PAGE_SIZE);

	List<ChallengeSummaryResponseDto> challengeList = queryFactory
		.select(Projections.constructor(ChallengeSummaryResponseDto.class, challenge))
		.from(challenge)
		.orderBy(challenge.createdAt.desc())
		.offset(pageable.getOffset())
		.limit(pageable.getPageSize())
		.fetch();
	return challengeList;
  }
```

ë„ëŒ€ì²´ ë‚˜ëŠ” ë¬´ì—‡ì„ í˜ì´ì§€ ì²˜ë¦¬í•˜ì˜€ëŠ”ê°€...?
ì´ ì½”ë“œë¥¼ ë§‰ìƒ í”„ë¡ íŠ¸ë‘ ì—°ê²°í•˜ë ¤ê³  í•˜ë‹ˆ í”„ë¡ íŠ¸ê°€ ë‹¹ì—°íˆ ì•Œ ìˆ˜ê°€ ì—†ì§€ .. í•´ë‹¹ ë°ì´í„°ê°€ ì–¼ë§ˆì¸ì§€ ì•Œ ìˆ˜ê°€ ì—†ëŠ”ë”©...
êµ¬ì§€ QueryDSLë¡œ í•œ ì´ìœ ë„ ì§€ê¸ˆ ìƒê°í•´ë³´ë‹ˆ ì™œê·¸ë¬ëŠ”ê°€ ì‹¶ë‹¤..ì „ì²´ì¡°íšŒë©´ findAllë¡œ ê°€ì ¸ì™€ë„ ë í…ë°,

QueryDSLì´ ì§ê´€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ì§€ì— ëŒ€í•´ì„œ ì˜ ë³´ì´ê¸° ë•Œë¬¸ì— ìµìˆ™í•´ì ¸ ê·¸ëŸ°ê±° ê°™ë‹¤.
í•˜ì§€ë§Œ JPAì¿¼ë¦¬ë‘ ìƒí™©ì— ë§ê²Œ ì ì ˆíˆ ì˜ ì‚¬ìš©í•˜ë„ë¡ ë…¸ë ¥í•´ì•¼ê² ë‹¤.

í˜„ì¬ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§ í•˜ë‹ˆ N+1ë¬¸ì œëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤ í•˜ë‚˜ì˜ ì¿¼ë¦¬ë¬¸ë§Œ ë‚˜ê°€ëŠ” ìƒíƒœ

![image](https://github.com/user-attachments/assets/59ff19c2-ef3c-498f-933f-cae2afe04822)
![image](https://github.com/user-attachments/assets/0e7f1709-dd42-47c6-8fdc-1f583b4b663d)


ê·¸ëŸ°ë° ê°€ë§Œíˆ ë°‘ì— ë“¤ì—¬ë‹¤ë³´ë‹ˆ ì´ ê²ƒì´ ë¬´ì—‡ì¸ê³ ..?


```
Serializing PageImpl instances as-is is not supported, meaning that there is no guarantee about the stability of the resulting JSON structure!
```

PageImpl ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìˆëŠ” ê·¸ëŒ€ë¡œ ì§ë ¬í™”í•˜ëŠ” ê²ƒì€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, ê²°ê³¼ JSON êµ¬ì¡°ì˜ ì•ˆì •ì„±ì´ ë³´ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤! ë¼ëŠ” ê²½ê³  ë©”ì„¸ì§€.....ã…ã…ã…ã…ã…ã…ã…...................

ë¦¬íŒ©í† ë§í–ˆë˜ ì½”ë“œ(service)

```java
@Transactional(readOnly = true)
    public Page<ChallengeSummaryResponseDto> getAllChallenges(int page, int size) {
        Pageable pageable = PageRequest.of(page, size);
        Page<Challenge> challengeList = challengeRepository.findAll(pageable);
        if (challengeList.isEmpty()) {
            throw new GlobalException(ErrorCode.NOT_FOUND_CHALLENGE);
        }
        List<ChallengeSummaryResponseDto> dtoList = new ArrayList<>();

        for (Challenge challenge : challengeList) {
            ChallengeSummaryResponseDto dto = new ChallengeSummaryResponseDto(challenge);
            dtoList.add(dto);
        }
        return new PageImpl<>(dtoList, pageable, challengeList.getTotalElements());
    }
```

ë‹¤ì‹œ ë¦¬íŒ©í† ë§í•œ ì½”ë“œ...ğŸ˜‚


```java

@Transactional(readOnly = true)
    public PaginationResponse<ChallengeSummaryResponseDto> getAllChallenges(int page, int size) {
        Pageable pageable = PageRequest.of(page, size);
        Page<Challenge> challenges = challengeRepository.findAll(pageable);
        if (challenges.isEmpty()) {
            throw new GlobalException(ErrorCode.NOT_FOUND_CHALLENGE);
        }
        List<ChallengeSummaryResponseDto> challengeList = challenges.getContent().stream()
            .map(ChallengeSummaryResponseDto::new)
            .toList();

        return new PaginationResponse<>(
            challengeList,
            challenges.getTotalPages(),
            challenges.getTotalPages(),
            challenges.getNumber(),
            challenges.getSize()
        );
    }

```


![image](https://github.com/user-attachments/assets/06daddde-046d-4193-b4ba-313e0bc5cd78)

ê²½ê³ ë©”ì„¸ì§€ ì‚¬ë¼ì¡Œë‹¤...í•˜í•˜

- challengePage.getTotalPages(): (ì´ í˜ì´ì§€ ìˆ˜)
- challengePage.getTotalElements(): (ì´ ë ˆì½”ë“œ ìˆ˜)
- challengePage.getNumber(): (í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸)
- challengePage.getSize(): (í˜ì´ì§€ë‹¹ ë ˆì½”ë“œ ìˆ˜)


Third-party cookie will be blocked in future Chrome versions as part of Privacy Sandbox.

 chrome://settings/trackingProtection

 ![image](https://github.com/user-attachments/assets/b9def08b-465a-4876-ae96-dfbecc2fe07d)